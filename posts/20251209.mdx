---
title: "[블로그 톤 기반 리뷰 생성 도구] RAG: 검색 결과가 독이 될 때"
date: "2025-12-09"
slug: "20251209"
tag: "사이드프로젝트, AI, RAG"
category: "사이드프로젝트"
description: "사이드프로젝트를 진행 일지, 두 번째, RAG는 만능이 아니다"
---

> LLM(거대언어모델) 애플리케이션을 개발할 때, **RAG(Retrieval-Augmented Generation)** 는 거의 필수적인 기술로 여겨집니다.  
최신 정보를 모르는 AI에게 외부 데이터를 주입해 똑똑하게 만드는 기술이죠.

하지만 최근 사이드 프로젝트를 개발하면서, RAG가 오히려 **독(Poison)** 이 되는 상황을 겪었습니다. 바로 "Context Contamination(맥락 오염)" 문제입니다.

## 문제 상황: "남의 경험"이 "내 경험"으로 둔갑하다.
사용자가 "오이도 조개구이집에 다녀왔다"라고 입력하면, 제 서비스는 Tavily API를 통해 해당 식당의 최신 정보를 긁어옵니다.  
여기서 문제가 발생합니다.

- **User Context (사용자 입력):** "대방어랑 가리비만 먹음. 배불렀음."
- **Retrieved Context (검색 결과):** "A블로거: 칼국수 존맛!", "B블로거: 여기는 해물라면이 필수!", "메뉴판: 모듬조개+칼국수 세트 인기"

AI는 이 두 가지 정보를 섞어서(Merge) 글을 작성하는데, **"정보의 풍부함"** 을 우선시하도록 튜닝된 모델은 **검색 결과(Retrieved Context)** 의 내용을 **사용자 경험(User Context)** 인 것처럼 서술해버립니다.

결국 사용자는 먹지도 않은 '해물라면'과 '칼국수'를 극찬하는, **거짓 후기(Hallucination)** 가 생성되는 것이죠.

### ❌ 실제 실패 사례 (Failure Case)
실제로 초기 모델이 생성한 텍스트 중 일부입니다.  
사용자는 **"배불러서 남겼다"** 고만 했는데, AI는 **"칼국수까지 먹었다"** 고 거짓말을 합니다.

- **User Input:** "조개구이 양이 많아서 다 못 먹고 남김."

- **AI Output (Hallucination):** "마무리는 역시 바지락 칼국수죠! 🔥 배가 터질 것 같았지만, 뜨끈한 국물에 김치 한 점 올려 먹으니 속이 확 풀리더라고요. 오이도 조개92 오시면 배불러도 칼국수는 꼭 드셔야 해요!"

이처럼 검색 결과(남들의 후기)에 압도되어, 사용자의 실제 경험(배불러서 남김)을 정면으로 반박하는 심각한 오류가 발생했습니다.

## 해결 전략: Truth Hierarchy (진실의 위계) 정립
이 문제를 해결하기 위해 프롬프트 엔지니어링 단계에서 **정보의 위계(Hierarchy)** 를 명확히 정의해야 했습니다.

### 1. Negative Constraints (부정 제약 조건) 추가
LLM은 "하지 마라"는 부정 명령보다 "해라"는 긍정 명령을 더 잘 따르는 경향이 있지만,  
이번 경우에는 명시적인 Negative Constraints가 필수적이었습니다.

<aside>
CRITICAL INSTRUCTION:

IF the item is NOT in the [User Draft], DO NOT write about it.
NEVER invent menu items based on [Store Information].
</aside>

### 2. Role Separation (역할 분리)
검색 결과(Search Result)와 사용자 초안(User Draft)의 역할을 엄격하게 분리했습니다.

- **User Draft:** Content Source (글의 내용, 줄거리, 감정선)
- **Search Result:** Metadata Source (가격, 정확한 메뉴명, 주소, 영업시간)
프롬프트 내에서 이 두 섹션을 물리적으로 멀리 떨어뜨리고, 각 섹션의 용도를 명시했습니다.

```
[3. Store Information]
*Use this ONLY for objective facts (Spelling, Prices).*
*DO NOT use this to infer what the user ate.*

[4. User Draft]
*This is the ABSOLUTE TRUTH.*
*Only write about events and food mentioned here.*
```

### 3. Micro-Expansion (미시적 확장)
기존에는 분량을 늘리기 위해 "새로운 사건"을 추가하려는 경향이 있었습니다.  
이를 방지하기 위해 **"수평적 확장(사건 추가)"** 이 아닌 **"수직적 확장(묘사 심화)"** 을 하도록 유도했습니다.

- Good: "조개 하나를 집어 들었다. 껍질 속에 고인 뽀얀 국물이..." (있는 사건의 디테일 강화)

## 정량적 성과: 할루시네이션 70% → 15% 감소
이러한 프롬프트 엔지니어링 적용 전후를 비교하기 위해, **총 20개의 테스트 케이스(짧은 초안 10개, 긴 초안 10개)** 를 무작위로 선정하여 내부 테스트를 진행했습니다.

|구분	| 개선 전 (Before)	| 개선 후 (After)	| 비고 |
| :---: | :---: | :---: | :--- |
|**할루시네이션 발생률**	| 70% (14/20) |	15% (3/20)	| 55%p 감소
|**치명적 오류 (없는 메뉴 창조)**	|12건	|0건	|칼국수, 볶음밥 등
|**경미한 오류 (과장된 표현)**	|2건	|3건|	맛 표현의 과장 등

결과적으로 '없는 메뉴를 지어내는' 치명적인 할루시네이션은 0건으로 완전히 제거되었으며,  
전체적인 오류 발생률도 1/4 수준으로 급감했습니다.

남은 15%의 오류 또한 "너무 맛있다"를 "눈물이 날 정도로 맛있다"로 표현하는 정도의 뉘앙스 차이로,  
블로그 글의 품질에는 큰 영향을 주지 않는 수준이었습니다.

## 결론: 자동화와 진정성 사이의 균형
RAG는 강력하지만, '개인의 경험'을 다루는 영역에서는 매우 조심스럽게 사용해야 합니다. 데이터의 **정확성(Accuracy)** 뿐만 아니라, 그 데이터가 **누구의 것(Ownership)** 인지 구분하는 것이 중요합니다.

이번 개선을 통해, AI는 더 이상 '아무말 대잔치'를 하지 않고, 사용자의 경험을 충실히 보조하는 진정한 Ghostwriter로 거듭날 수 있었습니다.
